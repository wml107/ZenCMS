# 视图层界面设计



# 对服务端响应统一处理



# 浏览网站内容的前台设计



# 管理网站的控制台设计

## 权限、用户管理

### 数据模型

在cookie中储存token，字段为Authorization。

在store中储存以下状态：

- Account
  - id
  - username
  - role 角色
  - claims 权限列表
- User[]
  - id
  - username
  - role
- Role[]
  - id
  - rolename
  - claims

### 各功能设计

#### 用户登录

- 用户事件/视图层：

  用表单中的值作为参数，调用login action → 根据返回值弹出提示，若成功则跳转路由。

- 数据层：

  调用api层请求服务端 → 成功则将账户信息更新到数据层 → 将调用结果返回。

- 网络接口(api)层：

  发送请求并将结果返回。

#### 特定功能检查登录状态、所需要权限

这种权限校验体现在多个场景：

- 每一次页面跳转时，在cookie中检查当前是否还具备token，如果令牌已经没了，则跳转至登录页。

  在路由层，通过路由守卫实现。

- 每一次收到服务端的响应时，对于未登录-401错误，需要提示用户并跳转路由至登录页；对于权限不足-403错误，需提示用户。

  在网络接口层，响应拦截器中实现。

- 对于需求特定权限才能管理的事项，经过判断后，若所登录账户不具备相关权限，则不加载对应的数据、不展示对应的界面/操作面板。

  在数据层、视图层中实现。

#### 自动登录

自动登录分两方面：

- 初入应用时，向服务端请求检验token有效性并获取账户信息。

  - 用户事件/视图层：

    在Vue App的生命周期钩子中绑定方法——在应用加载之初若cookie中有token，则调用autoLogin action。

    > 除此之外不需要做任何事情，因为这个功能不涉及用户操作，是应用自发行为，成功了不会有任何后续处理，失败了则会如上一个鉴权功能提到的，被响应拦截器捕获到这种失败，自动跳转到登录页。

  - 数据层：

    调用api层请求服务端 → 成功则将账户信息更新到数据层。

  - 网络接口层：

    发送网络请求并将结构返回。

- 每次发送任何请求，携带之前手动登录的认证信息(token)。

  在网络接口层，通过全局的请求拦截器实现。在cookie中读取token并放入请求头中。

#### 退出登录

- 用户事件/视图层：

  调用quit action → 根据返回值若执行成功，则跳转路由到登录页。

- 数据层：

  调用api层请求服务端 → 成功则清空数据层账户信息 → 将结果返回。

- 网络接口层：

  发送请求并将结果返回。

#### 密码修改

- 用户事件/视图层：

  以表单中数据作为参数，调用passwordUpdate action → 成功则提示用户。

- 数据层：

  调用api层请求服务端 → 将结果返回。

- 网络接口层：

  发送请求并将结果返回。
